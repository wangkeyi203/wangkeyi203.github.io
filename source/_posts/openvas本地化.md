---
title: gvmÁ¶ªÁ∫øÂàùÂßãÂåñ
date: 2021-11-30 12:26:39
tags:
- openvas
- gvm
---

Ê≠§ÊñáÊ°£ÊòØÂú®ÂÆâË£ÖÂÆågvmÁªÑ‰ª∂ÁöÑkaliÁ≥ªÁªü‰∏äÁ¶ªÁ∫øÂÆåÊàêgvmÂàùÂßãÂåñÁöÑÊìç‰ΩúÊñáÊ°£

# È¶ñÂÖàË¶ÅÂÖàÊäägvmÁªÑ‰ª∂ÂÆâË£ÖÂ•ΩÔºàËøô‰∏ÄÊ≠•Â¶ÇÊûúÈúÄË¶ÅÔºåÂèØ‰ª•‰πãÂêéÂèØ‰ª•‰øÆÊîπÊàêÂ∞ÜÂøÖË¶ÅÁöÑÂåÖ‰∏ãËΩΩÂà∞Êú¨Âú∞Êù•ÂÆâË£ÖÔºâ

ÂÖà‰øÆÊîπ /etc/apt/sources.list ÔºåÂ∞ÜkaliÊ∫êÊõ¥Êç¢‰∏Ä‰∏ãÔºåÂ¶ÇÊûúÈªòËÆ§ÊòØËøô‰∏™Ê∫êÂ∞±‰∏çÁî®Êç¢
```
deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib
deb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib
```
ÊâßË°å‰∏ãÈù¢ÂëΩ‰ª§Â∞ÜgvmÁõ∏ÂÖ≥ÁöÑÁªÑÂª∫ÂÆâË£ÖÂ•Ω
```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali]
‚îî‚îÄ# apt update
‚îî‚îÄ# apt install gvm*
```
ÂÆâË£ÖÂÆåÂèØ‰ª•Êü•Áúã‰∏ãgvmÁöÑÂÆâË£ÖÁâàÊú¨
```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali]
‚îî‚îÄ# gvmd --version                                                    127 ‚®Ø
Greenbone Vulnerability Manager 21.4.4
Manager DB revision 242
Copyright (C) 2009-2021 Greenbone Networks GmbH
License: AGPL-3.0-or-later
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
```

# Êñ≠ÁΩëÂàùÂßãÂåñgvm
Â¶ÇÊûúÊòØËÅîÁΩëÁöÑÁéØÂ¢ÉÔºåÂèØ‰ª•Áõ¥Êé•ÊâßË°å‰∏ãÈù¢ÂëΩ‰ª§ÂºÄÂßãËøõË°ågvmÁöÑÂàùÂßãÂåñÊµÅÁ®ã
```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali]
‚îî‚îÄ# gvm-setup
```
## Ê£ÄÊü•postgreSqlÁöÑÁâàÊú¨
Âú®ÂÆâË£ÖËøáÁ®ãÊàêÔºåÂèØËÉΩ‰ºöÈÅáÂà∞Á≥ªÁªüÈáåÊúâ‰∏§‰∏™ÁâàÊú¨PostgreSQLÁöÑÊÉÖÂÜµ
ÊúÄÊñ∞ÁâàÊú¨ÁöÑgvmÈúÄË¶Å14ÁâàÊú¨ÁöÑpostgresqlÊï∞ÊçÆÂ∫ìÔºåÂ¶ÇÊûúÁ≥ªÁªüÈáåÈªòËÆ§ÁöÑ‰∏ªÁâàÊú¨ÊòØ13ÁâàÊú¨ÔºåÂ∞±ÈúÄË¶Å‰øÆÊîπ‰∏Ä‰∏ã
### ÂÖàÊü•ÁúãÁ≥ªÁªüÈáåÁöÑPostgreSQLÁâàÊú¨

```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali]
‚îî‚îÄ# pg_lsclusters
Ver Cluster Port Status Owner    Data directory              Log file
13  main    5432 down   postgres /var/lib/postgresql/13/main /var/log/postgresql/postgresql-13-main.log
14  main    5433 down   postgres /var/lib/postgresql/14/main /var/log/postgresql/postgresql-14-main.log
```

### Âà†Èô§13ÁâàÊú¨ÁöÑPostgreSQL 
```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali]
‚îî‚îÄ# pg_dropcluster --stop 13 main
```
### Â∞Ü14ËÆæÁΩÆ‰∏∫‰∏ªË¶ÅÁâàÊú¨
```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali]
‚îî‚îÄ# pg_upgradecluster 14 main
```
ÁÑ∂ÂêéÊää14ÁâàÊú¨ÁöÑPostgreSQLÁõëÂê¨Á´ØÂè£‰øÆÊîπÊàê5432

‰øÆÊîπ/etc/postgresql/14/main/postgresql.conf ÔºåÂ∞ÜÂÖ∂‰∏≠ÁöÑport = ‰øÆÊîπ‰∏∫5432
```
port = 5432                             # (change requires restart)
max_connections = 100                   # (change requires restart)
#superuser_reserved_connections = 3     # (change requires restart)
unix_socket_directories = '/var/run/postgresql' # comma-separated list of directories
```

## Ëß£ÂéãÂàùÂßãÂåñËÑöÊú¨ÂåÖ
ÊàëÂ∑≤ÁªèÂ∞Ü‰øÆÊîπËøáÁöÑÂàùÂßãÂåñËÑöÊú¨ÂíåÂ§á‰ªΩÂ•ΩÁöÑÊï∞ÊçÆÂ∫ìÊñá‰ª∂ÊâìÂåÖÊàêinit_gvm.tar.gzÂåÖ
### Ëß£ÂéãÂéãÁº©ÂåÖ
```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali]
‚îî‚îÄ# tar -xzvf init_gvm.tar.gz
init_gvm/
init_gvm/init.sh
init_gvm/greenbone-feed-sync
init_gvm/plugins.tar.gz
init_gvm/greenbone-nvt-sync
init_gvm/gvm.tar.gz
```
### ËøõÂÖ•Âà∞init_gvmÁõÆÂΩïÔºåÊâßË°åinitËÑöÊú¨
```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali/init_gvm]
‚îî‚îÄ# sudo sh init.sh
```
### ÊâßË°ågvm-setupÂπ∂Á≠âÂæÖÂàùÂßãÂåñÂÆåÊàê
```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali/init_gvm]
‚îî‚îÄ# gvm-setup
```
### ÊâßË°ågvm-check-setupÊ£ÄÊü•ÂàùÂßãÂåñÊòØÂê¶ÊàêÂäü
```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali/init_gvm]
‚îî‚îÄ# gvm-check-setup
gvm-check-setup 21.4.3
  Test completeness and readiness of GVM-21.4.3
Step 1: Checking OpenVAS (Scanner)...
        OK: OpenVAS Scanner is present in version 21.4.3.
        OK: Server CA Certificate is present as /var/lib/gvm/CA/servercert.pem.
Checking permissions of /var/lib/openvas/gnupg/*
        OK: _gvm owns all files in /var/lib/openvas/gnupg
        OK: redis-server is present.
        OK: scanner (db_address setting) is configured properly using the redis-server socket: /var/run/redis-openvas/redis-server.sock
        OK: redis-server is running and listening on socket: /var/run/redis-openvas/redis-server.sock.
        OK: redis-server configuration is OK and redis-server is running.
        OK: _gvm owns all files in /var/lib/openvas/plugins
        OK: NVT collection in /var/lib/openvas/plugins contains 77525 NVTs.
Checking that the obsolete redis database has been removed
        OK: No old Redis DB
        OK: ospd-OpenVAS is present in version 21.4.3.
Step 2: Checking GVMD Manager ...
        OK: GVM Manager (gvmd) is present in version 21.4.4.
Step 3: Checking Certificates ...
        OK: GVM client certificate is valid and present as /var/lib/gvm/CA/clientcert.pem.
        OK: Your GVM certificate infrastructure passed validation.
Step 4: Checking data ...
        OK: SCAP data found in /var/lib/gvm/scap-data.
        OK: CERT data found in /var/lib/gvm/cert-data.
Step 5: Checking Postgresql DB and user ...
        OK: Postgresql version and default port are OK.
 gvmd      | _gvm     | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 |
        OK: At least one user exists.
Step 6: Checking Greenbone Security Assistant (GSA) ...
Oops, secure memory pool already initialized
        OK: Greenbone Security Assistant is present in version 21.4.3.
Step 7: Checking if GVM services are up and running ...
        Starting ospd-openvas service
        Waiting for ospd-openvas service
        OK: ospd-openvas service is active.
        Starting gvmd service
        Waiting for gvmd service
        OK: gvmd service is active.
        Starting greenbone-security-assistant service
        Waiting for greenbone-security-assistant service
        OK: greenbone-security-assistant service is active.
Step 8: Checking few other requirements...
        OK: nmap is present in version 21.4.3.
        OK: ssh-keygen found, LSC credential generation for GNU/Linux targets is likely to work.
        WARNING: Could not find makensis binary, LSC credential package generation for Microsoft Windows targets will not work.
        SUGGEST: Install nsis.
        OK: xsltproc found.
        WARNING: Your password policy is empty.
        SUGGEST: Edit the /etc/gvm/pwpolicy.conf file to set a password policy.

It seems like your GVM-21.4.3 installation is OK.
```
ÊòæÁ§∫Â¶Ç‰∏äÁªìÊûúÂàôË°®ÊòéÂàùÂßãÂåñËøáÁ®ãÊàêÂäüÂÆåÊàê
ÁÑ∂ÂêéÈáçÂêØ‰∏ãgvmÁöÑÊúçÂä°
```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali/init_gvm]
‚îî‚îÄ# gvm-stop
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali/init_gvm]
‚îî‚îÄ# gvm-start                                                           3 ‚®Ø
[>] Please wait for the GVM services to start.
[>]
[>] You might need to refresh your browser once it opens.
[>]
[>]  Web UI (Greenbone Security Assistant): https://127.0.0.1:9392

‚óè greenbone-security-assistant.service - Greenbone Security Assistant (gsad)
     Loaded: loaded (/lib/systemd/system/greenbone-security-assistant.service; disabled; vendor preset: disabled)
     Active: active (running) since Tue 2021-11-30 18:30:45 CST; 9ms ago
       Docs: man:gsad(8)
             https://www.greenbone.net
    Process: 6970 ExecStart=/usr/sbin/gsad --listen=127.0.0.1 --port=9392 (code=exited, status=0/SUCCESS)
   Main PID: 6971 (gsad)
      Tasks: 3 (limit: 4578)
     Memory: 2.1M
        CPU: 15ms
     CGroup: /system.slice/greenbone-security-assistant.service
             ‚îú‚îÄ6971 /usr/sbin/gsad --listen=127.0.0.1 --port=9392
             ‚îî‚îÄ6972 /usr/sbin/gsad --listen=127.0.0.1 --port=9392

11Êúà 30 18:30:45 kali systemd[1]: Starting Greenbone Security Assistant (gsad)...
11Êúà 30 18:30:45 kali gsad[6970]: Oops, secure memory pool already initialized
11Êúà 30 18:30:45 kali systemd[1]: Started Greenbone Security Assistant (gsad).

‚óè gvmd.service - Greenbone Vulnerability Manager daemon (gvmd)
     Loaded: loaded (/lib/systemd/system/gvmd.service; disabled; vendor preset: disabled)
     Active: active (running) since Tue 2021-11-30 18:30:40 CST; 5s ago
       Docs: man:gvmd(8)
    Process: 6939 ExecStart=/usr/sbin/gvmd --osp-vt-update=/run/ospd/ospd.sock --listen-group=_gvm (code=exited, status=0/SUCCESS)
   Main PID: 6945 (gvmd)
      Tasks: 1 (limit: 4578)
     Memory: 5.2M
        CPU: 63ms
     CGroup: /system.slice/gvmd.service
             ‚îî‚îÄ6945 "gvmd: Waiting for incoming connections" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""

11Êúà 30 18:30:39 kali systemd[1]: Starting Greenbone Vulnerability Manager daemon (gvmd)...
11Êúà 30 18:30:39 kali systemd[1]: gvmd.service: Can't open PID file /run/gvm/gvmd.pid (yet?) after start: Operation not permitted
11Êúà 30 18:30:40 kali systemd[1]: Started Greenbone Vulnerability Manager daemon (gvmd).

‚óè ospd-openvas.service - OSPd Wrapper for the OpenVAS Scanner (ospd-openvas)
     Loaded: loaded (/lib/systemd/system/ospd-openvas.service; disabled; vendor preset: disabled)
     Active: active (running) since Tue 2021-11-30 18:30:39 CST; 5s ago
       Docs: man:ospd-openvas(8)
             man:openvas(8)
    Process: 6935 ExecStart=/usr/bin/ospd-openvas --config /etc/gvm/ospd-openvas.conf --log-config /etc/gvm/ospd-logging.conf --unix-socket /run/ospd/ospd.sock --pid-file /run/ospd/ospd-openvas.pid --log-file /var/log/gvm/ospd-openvas.log --lock-file-dir /var/lib/openvas (code=exited, status=0/SUCCESS)
   Main PID: 6937 (ospd-openvas)
      Tasks: 4 (limit: 4578)
     Memory: 24.0M
        CPU: 199ms
     CGroup: /system.slice/ospd-openvas.service
             ‚îú‚îÄ6937 /usr/bin/python3 /usr/bin/ospd-openvas --config /etc/gvm/ospd-openvas.conf --log-config /etc/gvm/ospd-logging.conf --unix-socket /run/ospd/ospd.sock --pid-file /run/ospd/ospd-openvas.pid --log-file /var/log/gvm/ospd-openvas.log --lock-file-dir /var/lib/openvas
             ‚îî‚îÄ6940 /usr/bin/python3 /usr/bin/ospd-openvas --config /etc/gvm/ospd-openvas.conf --log-config /etc/gvm/ospd-logging.conf --unix-socket /run/ospd/ospd.sock --pid-file /run/ospd/ospd-openvas.pid --log-file /var/log/gvm/ospd-openvas.log --lock-file-dir /var/lib/openvas

11Êúà 30 18:30:39 kali systemd[1]: Starting OSPd Wrapper for the OpenVAS Scanner (ospd-openvas)...
11Êúà 30 18:30:39 kali systemd[1]: Started OSPd Wrapper for the OpenVAS Scanner (ospd-openvas).

[>] Opening Web UI (https://127.0.0.1:9392) in: 5... 4... 3... 2... 1...
```
### ËÆæÁΩÆÁî®Êà∑ÂêçÂíåÂØÜÁ†Å

```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/kali/init_gvm]
‚îî‚îÄ# runuser -u _gvm -- gvmd --user=admin --new-password=abc123
```

## gvm ‰ΩøÁî®
ÊâìÂºÄÊµèËßàÂô®ÔºåËæìÂÖ•127.0.0.1:9392 Â¶ÇÂõæÔºåÁÇπÂáªadvanced,ÁÑ∂ÂêéÂÜçÁÇπÂáª Accept the Risk and Continue
![1](./openvasÊú¨Âú∞Âåñ/1.png)

ËæìÂÖ•ÂàöÊâçËÆæÁΩÆÁöÑÁî®Êà∑ÂêçÂØÜÁ†Å
![2](./openvasÊú¨Âú∞Âåñ/2.png)

Âú®AdministrationÊ†è‰∏≠ÈÄâÊã©feed status
![3](./openvasÊú¨Âú∞Âåñ/3.png)
Á≠âSCAP CERT GVMD_DATAÁöÑStatusÈ°π‰ªéupdating...ÁöÑÁä∂ÊÄÅÂèò‰∏∫ xx days‰πãÂêéÔºåÂ∞±ÂèØ‰ª•Ê≠£Â∏∏‰ΩøÁî®gvmÊù•ËøõË°åÊºèÊ¥ûÊâ´Êèè‰∫Ü„ÄÇ

# Êõ¥Êñ∞Êï∞ÊçÆÂ∫ì

## ËÅîÁΩëÊú∫Âô®

ËÅîÁΩëÁöÑÊú∫Âô®Êõ¥Êñ∞Êõ¥Êñ∞ÊºèÊ¥ûÊï∞ÊçÆÂ∫ìÂè™ÈúÄË¶ÅÊâßË°å‰∏ãÈù¢ÂëΩ‰ª§Âç≥ÂèØ

```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/wky]
‚îî‚îÄ# gvm-feed-update
```



## Êñ≠ÁΩëÊú∫Âô®Êõ¥Êñ∞

Êñ≠ÁΩëÊú∫Âô®Êõ¥Êñ∞ÈúÄË¶ÅÂÖàÂ∞ÜÊõ¥Êñ∞Â•ΩÁöÑÊú∫Âô®‰∏≠Êï∞ÊçÆÂ∫ìÊñá‰ª∂Êï¥‰ΩìÊâìÂåÖÂá∫Êù•

```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/var/lib/openvas]
‚îî‚îÄ# tar -czvf ~/plugins.tar.gz /var/lib/openvas/plugins
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/var/lib]
‚îî‚îÄ# tar -czvf ~/gvm.tar.gz /var/lib/gvm
```

Â∞ÜÊâìÂåÖÂ•ΩÁöÑplugins.tar.gz Âíågvm.tar.gzÊãøÂà∞Êñ≠ÁΩëÊú∫Âô®‰∏äÂπ∂Â§çÂà∂Âà∞ /tmpÁõÆÂΩï‰∏ã

ÁÑ∂ÂêéÂÜçÊâßË°å

```
‚îå‚îÄ‚îÄ(rootüíÄkali)-[/home/wky]
‚îî‚îÄ# gvm-feed-update
```

Âç≥ÂèØÔºåÂõ†‰∏∫Êñ≠ÁΩëÁöÑÊõ¥Êñ∞ËÑöÊú¨Â∑≤ÁªèË¢´‰øÆÊîπËøá‰∫ÜÔºå‰ºöÂú®/tmp‰∏ãÂØªÊâæÊï∞ÊçÆÂ∫ìÁöÑÂéãÁº©ÂåÖÊù•Êõ¥Êñ∞Êï∞ÊçÆÂ∫ì
